<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seleccionar Destino - Migraci√≥n de Playlist</title>
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <div class="step-indicator">
            <div class="step completed">
                <div class="step-number">‚úì</div>
                <div class="step-label">Origen</div>
            </div>
            <div class="step active">
                <div class="step-number">2</div>
                <div class="step-label">Destino</div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-label">Configurar</div>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <div class="step-label">Migrar</div>
            </div>
        </div>

        <div id="info-origen" class="selection-info">
            <p><strong>Origen:</strong> <span id="origen-nombre">Cargando...</span></p>
        </div>

        <h2>¬øA qu√© plataforma deseas importar tu playlist?</h2>
        
        <div class="botones">
            <button class="btn btn-spotify" onclick="seleccionarDestino('Spotify')">
                üéµ Spotify
            </button>
            <button class="btn btn-youtube" onclick="seleccionarDestino('YTMusic')">
                ‚ñ∂Ô∏è YouTube Music
            </button>
        </div>

        <div id="status" class="status"></div>

        <div class="botones" style="margin-top: 40px;">
            <a href="/seleccionar-origen" style="text-decoration: none;">
                <button class="btn btn-secondary">‚¨ÖÔ∏è Volver</button>
            </a>
        </div>
    </div>

    <script>
        // Cargar informaci√≥n del origen al iniciar
        async function cargarOrigen() {
            try {
                const res = await fetch('/obtener-datos');
                const data = await res.json();
                
                if (data.origen) {
                    document.getElementById('origen-nombre').textContent = data.origen;
                } else {
                    window.location.href = '/seleccionar-origen';
                }
            } catch (err) {
                console.error('Error al cargar origen:', err);
            }
        }

        async function seleccionarDestino(plataforma) {
            const status = document.getElementById('status');
            status.className = 'status loading';
            status.textContent = '‚è≥ Guardando selecci√≥n...';
            
            try {
                const res = await fetch('/guardar-destino', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ plataforma })
                });
                
                const data = await res.json();
                
                if (data.status === 'success') {
                    status.className = 'status success';
                    status.textContent = `‚úÖ ${plataforma} seleccionado como destino`;
                    
                    // Redirigir despu√©s de 1 segundo
                    setTimeout(() => {
                        window.location.href = '/configurar';
                    }, 1000);
                } else {
                    status.className = 'status error';
                    status.textContent = '‚ùå Error al guardar la selecci√≥n';
                }
            } catch (err) {
                status.className = 'status error';
                status.textContent = '‚ùå Error de conexi√≥n con el servidor';
                console.error(err);
            }
        }

        // Cargar informaci√≥n al iniciar la p√°gina
        cargarOrigen();
    </script>
</body>
</html>